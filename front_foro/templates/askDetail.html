{% extends "foro_parent.html" %}

{% comment %}
	template for view a ask with his answers and comments 
{% endcomment %}

{% load staticfiles %}

{% block foro_content %}
	<div class="col-md-12">

		<div class="row">

			<!-- se pega el titulo de la pregunta -->
			<h3 class="ask_title titulos"></h3>
			<h3 class="ask_edit titulos" hidden>edita tu pregunta</h3>
			
			<div class="col-md-9 content_ask">

				<!--formulario oculto en caso de editar -->
				<form class="margen_contenido" id="form_ask_edit_foro" hidden>
					<textarea id="id_textarea_ask" name="content" data-provide="markdown" rows="10"></textarea>
					<br>
	      			<button class="btn btn-default pull-right" type="submit" name="action">Actualizar</button>
	      		</form>
				
				<!-- se pega el contenido de la pregunta -->
				<p class="ask_summary"></p>

				<div class="col-md-10 col-sm-offset-1">

					<!-- contenedor de los comentarios -->
					<div id="list-comment-ask">	</div>
					<div class="load-comment-ask" hidden><a>Ver m√°s</a></div>

				</div>

				
				<div class="col-md-10 col-sm-offset-1">
					<!-- formulario para crear el comentario -->
						<form id="form-comment-ask" hidden>
							<button id="btn-comment" class="btn btn-default pull-right" type="submit" name="action">Comentar</button>
						</form>	
					
				</div>
				
			</div>

			<!-- contenedor con info sobre la pregunta -->
			<div class="col-md-3 info_ask">
				<p>
					Preguntado por:
						<a class="ask_author_link">
							<span class="ask_author"></span>
						</a>
				</p>
				<span class="ask_added_at"></span>
			</div>
		</div>

		<!-- contenedor con las respuestas de la pregunta -->
		<div class="row">
			
			<h3 class="titulos"><span class="count-answer"></span></h3>
			
			<div class="answer"></div>
			
			<div class=""><span class="load-answer-more"></span></div>
			
			<form id="form-comment-clone" hidden>
				<button id="btn-comment" class="btn btn-default pull-right" type="submit" name="action">Comentar</button>
			</form>
		</div>

		<!-- contenedor con el formulario para dejar mi respuesta -->
		<div class="row your_answer">
			<h3 class="titulos">Tu respuesta</h3>

			<div class="col-md-8 col-sm-8 col-xs-8 col-sm-offset-2">
				<form class="" id="form_answer_foro" hidden>
					<textarea id="id_textarea" name="content" data-provide="markdown" rows="10"></textarea>
					<br>
					<button class="btn btn-default pull-right" type="submit" name="action">Responder</button>
		      	</form>
		      	<div class="my-answer"></div>
			</div>		
		</div>



	</div>
	

	
{% endblock foro_content %}

{% block scripts %}
	<script type="text/javascript">
		
		function clear_editor(answer)
		{
			$('#form_answer_foro').trigger("reset");
			// contador de las repuestas 
			count = $('.count-answer').text();
			count.split(' ');
			count = parseInt(count[0])
			count = count+1+" ";

			if(count == '1 '){
				$(".count-answer").text(count + 'Respuesta')
			}else{
				$(".count-answer").text(count + 'Respuestas')	
			}

			ForumView.append_answer_to_ask(answer, $('.answer'));
		}

		//Se obtiene el id 
		var id = location.pathname.split("/");
		id = id[id.length-1];
		console.log(id)

				
		ForumService.get_Detail_Ask(id);

		ForumService.get_Answers(
			URL_GET_ANSWERS_FORUM+'/'+id+'/',
			show_detail_answers,
			$('.answer')
		);
		

		
		//###   ANSWER   ###
		//form Answer, to Ask at Foro

		form_answer_foro = $("#form_answer_foro");
		create_form(URL_CREATE_ANSWER_FORO, form_answer_foro, 'OPTIONS', ForumView.handleAnswer);
		$(form_answer_foro).show();



		form_answer_foro.submit(function (e) {
			e.preventDefault();
			$("#id_ask").val(id),
			ForumService.create_answer(
				form_answer_foro,
				URL_CREATE_ANSWER_FORO,
				clear_editor
			);
		})
		//###   end ANSWER   ###


		//###   COMMENT   ###
		console.log("parent: "+id)
		var comentariosAsk = new CommentView(
			id,
			$("#form-comment-ask"),
			$('#list-comment-ask'),
			$(".load-comment-ask")
		);		
		comentariosAsk.load();
		comentariosAsk.load_create_comment(id);
		//###   end COMMENT   ###


	</script>
{% endblock scripts %}