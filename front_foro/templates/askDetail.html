{% extends "foro_parent.html" %}

{% comment %}
	template for view a ask with his answers and comments 
{% endcomment %}

{% load staticfiles %}

{% block foro_content %}
	<div class="col-md-12">

		<div class="row">

			<!-- se pega el titulo de la pregunta -->
			<h3 class="ask_title titulos"></h3>
			
			<div class="col-md-9 content_ask">
				
				<!-- se pega el contenido de la pregunta -->
				<p class="ask_summary"></p>

				<div class="col-md-10 col-sm-offset-1">

					<!-- contenedor de los comentarios -->
					<div id="list-comment" class="">
						
					</div>
					<div>
						<span class="load-comment"></span>	
					</div>

				</div>

				<div class="col-md-10 col-sm-offset-1 link_comment">
					<!-- btn para crear un comentario -->
					<a class="btn-create pull-right" id="a-comment">agrega un comentario</a>
	
				</div>
				
				<div class="col-md-10 col-sm-offset-1">
					<!-- formulario para crear el comentario -->
						<form id="form-comment" hidden>
							<button id="btn-comment" class="btn btn-default pull-right" type="submit" name="action">Comentar</button>
						</form>	
					
				</div>
				
			</div>

			<!-- contenedor con info sobre la pregunta -->
			<div class="col-md-3 info_ask">
				<p>
					Preguntado por:
						<a class="ask_author_link">
							<span class="ask_author"></span>
						</a>
				</p>
				<span class="ask_added_at"></span>
			</div>
		</div>

		<!-- contenedor con las respuestas de la pregunta -->
		<div class="row">
			
			<h3 class="titulos"><span class="count-answer"></span></h3>
			
			<div class="answer"></div>
				<div class="">
					<span class="load-answer"></span>
				</div>
		</div>

		<!-- contenedor con el formulario para dejar mi respuesta -->
		<div class="row your_answer">
			<h3 class="titulos">Tu respuesta</h3>

			<div class="col-md-8 col-sm-8 col-xs-8 col-sm-offset-2">
				<form class="" id="form_answer_foro" hidden>
					<textarea id="id_textarea" name="content" data-provide="markdown" rows="10"></textarea>
					<br>
					<button class="btn btn-default pull-right" type="submit" name="action">Responder</button>
		      	</form>
		      	<div class="my-answer"></div>
			</div>		
		</div>
	</div>
	
	
{% endblock foro_content %}

{% block scripts %}
	<script type="text/javascript">
		function handle()
		{
			var input_ask = $(form_answer_foro).get(0)[0];
			$(input_ask).hide();
			$(input_ask).val(id);

			var input_text = $(form_answer_foro).get(0)[1];
			$(input_text).hide()
			$('textarea').keyup(function(e){
				$(input_text).val($(e.target).val())
	        });
		}

		function clear_editor(answer)
		{
			console.log('clear_editor')
			console.log(answer)
			$('#form_answer_foro').trigger("reset");
			

			// contador de las repuestas 
			count = $('.count-answer').text();
			count.split(' ');
			count = parseInt(count[0])
			count = count+1+" ";

			if(count == '1 '){
				$(".count-answer").text(count + 'Respuesta')
			}else{
				$(".count-answer").text(count + 'Respuestas')	
			}

			ForumView.append_answer_to_ask(answer, $('.answer'));
		}


		//Se obtiene el id 
		var id = location.pathname.split("/");
		id = id[id.length-1];
		
		ForumService.get_Detail_Ask(id);
		ForumService.get_Answers(URL_GET_ANSWERS_FORUM, show_detail_answers);
		CommentService.get_Comments(URL_GET_COMMENTS, show_detail_comments);

		
		//###   ANSWER   ###
		//form Answer, to Ask at Foro

		form_answer_foro = $("#form_answer_foro");
		create_form(URL_CREATE_ANSWER_FORO, form_answer_foro, 'OPTIONS', handle);
		$(form_answer_foro).show();



		form_answer_foro.submit(function (e) {
			e.preventDefault();
			$("#id_ask").val(id),
			console.log($("#id_text").val( ))
			ForumService.create_answer(
				form_answer_foro,
				URL_CREATE_ANSWER_FORO,
				clear_editor
			);
		})
		//###   end ANSWER   ###


		//###   COMMENT   ###
		//Form Comment, to Comment at Ask
		form_comment_ask = $("#form-comment");
		create_form(URL_CREATE_COMMENT, form_comment_ask, 'OPTIONS');

		form_comment_ask.submit(function (e) {
			e.preventDefault();
			CommentService.create(
				form_comment_ask,
				URL_CREATE_COMMENT,
				CommentView.append_comment
				);
			$(e.target).parent().fadeOut("slow");
			$("#a-comment").fadeIn("slow");
		})

		$("#a-comment").click(function (e) {
			e.preventDefault()
			$("#a-comment").fadeOut("slow")//.hide()
			$("#form-comment").fadeIn("slow")//.show()
		})

		
	
		//###   end COMMENT   ###


	</script>
{% endblock scripts %}