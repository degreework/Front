{% extends "wiki_parent.html" %}
{% comment %}
	template for listing wiki pages
{% endcomment %}



{% block wiki_content %}
<div class="margen_contenido">

	<div id="editaded_page" hidden>
		{% include "page_wiki.html" %}
	</div>

	<form id="form_create_wiki" hidden>
		<div id="editor"></div>
		<button class="btn btn-default pull-right" type="submit" name="action" id="btn-wiki">Guardar</button>
	</form>	
		      	
</div>
{% endblock wiki_content %}

{% block scripts %}

<script>

	function slug(str)
	{
		str = str.replace(/\s/g,'-');
		str = str.replace(/[^a-zA-Z0-9\s]/g,"");
		str = str.toLowerCase();
		return str;
	}

	function handle()
	{
		/*
		* Event listener to form
		*/

		//append editor content to raw input
		$('textarea').keyup(function(e){
			$("#id_raw").val($('#editor').markdownEditor('content'))
	    });

		//generate slug
		$($("input[name=title]")[0]).keyup( function(){
			var title = $(this).val();
            var url = $('input#id_slug');
            $($("input[name=slug]")[0]).val(slug(title));
        });

        //show form
        $(form_create_wiki).show()
	}

	function create_succes (response) {
		$("#form_create_wiki").hide();
		Wiki.show_page_content(response);
		$("#editaded_page").show();
	}

	$('#form_create_wiki').submit(function(e){
		e.preventDefault();
		WikiService.create_page(
			form_create_wiki,
			URL_CREATE_PAGE_WIKI,
			create_succes
		);

	});

    jQuery(document).ready(function($) {
    	//form wiki create
		form_create_wiki = $("#form_create_wiki");
	    
	    //create form to page
		create_form(URL_CREATE_PAGE_WIKI, form_create_wiki, 'OPTIONS', handle);

        //load markdown editor
		MarkdownEditor.load($('#editor'));

    });
</script>

{% endblock scripts %}