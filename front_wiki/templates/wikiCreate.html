{% extends 'template_base.html' %}
{% block contenido %}
	<div class="col-md-10 col-md-offset-1 capacity">
		<h2 class="titulos">Crea tu tema</h2>
	
		<div class="col-md-10 col-sm-10 col-xs-10 col-md-offset-1 margen_contenido">
			
			
				
				<form id="form_create_wiki"></form>
		      	<form id="form_update_wiki"><div id="editor">
		      		
		      	</div></form>	
		      	
				<button class="btn btn-default pull-right" type="submit" name="action" id="btn-wiki">Crear</button>
		</div>
	</div>

{% endblock %}

{% block scripts %}

{% load staticfiles %}
	<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
<link href="{% static 'libs/bootstrap-markdown-editor/dist/css/bootstrap-markdown-editor.css' %}" rel="stylesheet">
<script src="{% static 'libs/marked/marked.min.js' %}"></script>
<script src="{% static 'libs/bootstrap-markdown-editor/dist/js/bootstrap-markdown-editor.js' %}"></script>


<script>

	function slug(str)
	{
		str = str.replace(/[^a-zA-Z0-9\s]/g,"");
		str = str.toLowerCase();
		str = str.replace(/\s/g,'-');
		return str;
	}

	function handle()
	{
		$('#id_title').keypress( function(){
			var title = $(this).val();
            var url = $('input#id_slug');
            $('input#id_slug').val(slug(title));
        });

        $("#id_raw").hide()
	}
    
    function update()
    {
    	console.log("update")
		var id = WikiService.id;
		console.log(id)
		WikiService.update_page(form_update_wiki, URL_CREATE_PAGE_WIKI+id)
    }

    //form wiki create
	form_create_wiki = $("#form_create_wiki");

	//form update wiki
	form_update_wiki = $("#form_update_wiki");


	$('#btn-wiki').click(function(e){
		e.preventDefault();
		WikiService.create_page(
			form_create_wiki,
			URL_CREATE_PAGE_WIKI,
			update
		);

		//

	});


    jQuery(document).ready(function($) {
	    	//create page
		create_form(URL_CREATE_PAGE_WIKI, form_create_wiki, 'OPTIONS');

		//update page
		create_form(URL_CREATE_PAGE_WIKI+"0", form_update_wiki, 'OPTIONS', handle);

        $('#editor').markdownEditor({
            preview: true,
            height: 100,
            onPreview: function (content, callback) {
                callback( marked(content) );
            }
        });

    });
</script>

{% endblock scripts %}